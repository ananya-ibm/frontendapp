# Storybook EXO Theme Addon

There are three parts to this addon

1. Adding a reference from each story to the theme
2. Parsing the theme
3. The React UI

The entry-point of the addon is `src/preset.js` - which registers the three
above mentioned parts.

## Adding a reference from each story to the theme

This is done through a babel plugin, which essentially replaces

```javascript
export default { title: 'Components/Core/HeroCarousel' };
```

with

```javascript
const _ref = { title: 'Components/Core/HeroCarousel' };
_ref.parameters = _ref.parameters || {};
_ref.parameters.themeAddon = require('./HeroCarousel.theme?theme-ast');
export default _ref;
```

The code is found in `src/themeRefBabelPlugin.js`

This reference/import is needed for step 2, parsing the theme to be triggered
through a webpack loader.

## Parsing the theme

A special webpack loader is registered and is triggered thorugh the `theme-ast`
require query parameter. The code is found in `src/themeAstLoader.js?`

The webpack loader parses the AST generated by Babel and creates a JSON
structure representing the theme that can be parsed by the UI.

This code is somewhat brittle, and there is likely to be source code constructs
that may appear in theme files that are not supported.

However, if the theme follows the standard practice of returning a JavaScript
object with simple keys and values being either native types, references to
theme variables or template literals, the loader should work.

## The React UI

The React UI is contained in `ThemePanel.jsx` - nothing special besides
following the storybook addon APIs
